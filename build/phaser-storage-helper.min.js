/*!
 * phaser-super-storage - version 1.0.4 
 * A cross platform storage plugin for Phaser
 *
 * Azerion
 * Build at 15-03-2019
 * Released under MIT License 
 */

var PhaserSuperStorage;!function(a){var b;!function(a){a[a.init=0]="init",a[a.setItem=1]="setItem",a[a.getItem=2]="getItem",a[a.removeItem=3]="removeItem",a[a.clear=4]="clear",a[a.setNamespace=5]="setNamespace",a[a.length=6]="length",a[a.key=7]="key",a[a.error=8]="error"}(b=a.StorageCommand||(a.StorageCommand={}));var c=function(){function a(){}return a.isLocalStorageSupport=function(){try{if("object"==typeof localStorage)return localStorage.setItem("testingLocalStorage","foo"),localStorage.removeItem("testingLocalStorage"),!0}catch(a){return!1}return!1},a.validateMessage=function(a){return a.hasOwnProperty("command")?a:null},a.nameSpaceKeyFilter=function(a,b){return a.filter(function(a){return a.substring(0,b.length)===b})},a}();a.StorageUtils=c}(PhaserSuperStorage||(PhaserSuperStorage={}));var PhaserSuperStorage;!function(a){var b;!function(b){var c=function(){function b(a){void 0===a&&(a=""),this.namespace="",this.forcePromises=!1,this.setNamespace(a)}return Object.defineProperty(b.prototype,"length",{get:function(){var b=Object.keys(localStorage);return a.StorageUtils.nameSpaceKeyFilter(b,this.namespace).length},enumerable:!0,configurable:!0}),b.prototype.key=function(a){return this.forcePromises?this.promisefy(this._key,arguments):this._key(a)},b.prototype._key=function(b){var c=Object.keys(localStorage),d=a.StorageUtils.nameSpaceKeyFilter(c,this.namespace),e=localStorage.getItem(d[b]);return e},b.prototype.getItem=function(a){return this.forcePromises?this.promisefy(this._getItem,arguments):this._getItem(a)},b.prototype._getItem=function(a){return localStorage.getItem(this.namespace+a)},b.prototype.setItem=function(a,b){return this.forcePromises?this.promisefy(this._setItem,arguments):this._setItem(a,b)},b.prototype._setItem=function(a,b){return localStorage.setItem(this.namespace+a,b)},b.prototype.removeItem=function(a){return this.forcePromises?this.promisefy(this._removeItem,arguments):this._removeItem(a)},b.prototype._removeItem=function(a){return localStorage.removeItem(this.namespace+a)},b.prototype.clear=function(){return this.forcePromises?this.promisefy(this._clear,arguments):this._clear()},b.prototype._clear=function(){for(var b=Object.keys(localStorage),c=a.StorageUtils.nameSpaceKeyFilter(b,this.namespace),d=0;d<c.length;d++)localStorage.removeItem(c[d])},b.prototype.setNamespace=function(a){return this.forcePromises?this.promisefy(this._setNameSpace,arguments):this._setNameSpace(a)},b.prototype._setNameSpace=function(a){a&&(this.namespace=a+":")},b.prototype.promisefy=function(a,b){var c=this;return new Promise(function(d,e){d(a.apply(c,b))})},b}();b.LocalStorage=c}(b=a.StorageAdapters||(a.StorageAdapters={}))}(PhaserSuperStorage||(PhaserSuperStorage={}));var StorageCommand=PhaserSuperStorage.StorageCommand,StorageUtils=PhaserSuperStorage.StorageUtils,LocalStorage=PhaserSuperStorage.StorageAdapters.LocalStorage;!function(){var a=window.gameOrigin||"*",b=StorageUtils.isLocalStorageSupport(),c=b?new LocalStorage:null;window.addEventListener("message",function(d){if("*"===a||d.origin===a){var e=StorageUtils.validateMessage(d.data),f=d.ports[0];if("undefined"!=typeof f&&f){var g=function(a,b){f.postMessage({status:"error",command:a,value:b})};if(null!==e)switch(b||g(e.command,"localStorage not supported"),e.command){case StorageCommand.init:f.postMessage({status:"ok",command:e.command,length:c.length});break;case StorageCommand.getItem:try{var h=c.getItem(e.key);f.postMessage({status:"ok",command:e.command,value:h,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.setItem:try{c.setItem(e.key,e.value),f.postMessage({status:"ok",command:e.command,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.removeItem:try{c.removeItem(e.key),f.postMessage({status:"ok",command:e.command,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.setNamespace:try{c.setNamespace(e.value),f.postMessage({status:"ok",command:e.command,value:e.value,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.clear:try{c.clear(),f.postMessage({status:"ok",command:e.command,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.length:try{f.postMessage({status:"ok",command:e.command,value:c.length,length:c.length})}catch(a){g(e.command,a.message)}break;case StorageCommand.key:try{var i=c.key(e.value);f.postMessage({status:"ok",command:e.command,value:i,length:c.length})}catch(a){g(e.command,a.message)}break;default:g(e.command,"Command not found")}else g(StorageCommand.error,"Empty message!")}}})}();